<div class="row element-style">
  <div class="col-md-8 col-md-offset-2">
    <% if @errors %>
      <% @errors.each do |error| %>
        <div class="'has-error alert alert-danger alert-dismissable'">
          <button name="button" type="button" class="close" data-dismiss="alert">×</button>
          <%= error %>
        </div>
      <% end%>
    <% end%>
    <fieldset>
      <div class="row">
        <legend class="col-lg-12"><%= @position.unit.campaign.name %></legend>
      </div>
      <button class="accordion">Instrucciones de cumplimentación de la encuesta</button>
      <div class="panel-instructions">
        <div class="form-group org-panel-instructions">
          <div class="row">
            <div class="col-lg-12">
              <table class="table table-striped table-hover ">
                <thead>
                  <th></th>
                </thead>
                <tbody>
                  <tr>
                    <td>Instrucción 1. Responder en orden las preguntas.</td>
                  </tr>
                  <tr>
                    <td>Instrucción 2. Confirmar cada tarea.</td>
                  </tr>
                  <tr>
                    <td>Instrucción 3...</td>
                  </tr>
                  <tr>
                    <td>Instrucción 4...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="per-bar">
        <h5><b>Tiempo restante: <%= @total_per %>%</b></h5>
        <div class="progress progress-striped">
          <div class="progress-bar progress-bar-success" style="width: <%= @total_per %>%"></div>
        </div>
      </div>

      <div class="form-group">
        <div class="row question-mark">
          <h4 class="col-lg-12 control-label question">¿En qué ha destinado el tiempo el último trimestre?</h4>
        </div>
        <div class="row">
          <table class="table table-striped table-hover ">
            <thead>
              <th>Tarea</th>
              <th>% Tiempo</th>
            </thead>
            <tbody>
              <% @pos_functions.each do |function| %>
                <tr>
                  <td>
                    <div>
                      <p>
                        <%= function.name %>
                      </p>
                    </div>
                  </td>
                  <td>
                  <form class="form-horizontal survey-form" action="/surveys/create" method="POST">
                    <input class="form-control input-sm" type="text" name="time_per" id="survey-input">
                    <input type="hidden" class="form-control input-sm task" type="text" id="inputSmall" value="<%= function.id %>" name="function_id">
                    <input type="hidden"value="<%= form_authenticity_token() %>" name="authenticity_token"/>
                    <button class="btn btn-success save-response" type="submit" >Confirmar</button>
                  </form>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- other tasks form -->
      <!-- <div class="form-group">
        <div class="row">
          <label class="col-lg-12 control-label">Otras tareas realizadas: </label>
        </div>
        <div class="row">
          <table class="table table-striped table-hover ">
            <thead>
              <th></th>
              <th>Tarea</th>
              <th>% Tiempo</th>
            </thead>
            <tbody id="other-tasks">
              <tr>
                <td>
                  <td>
                    <input class="form-control input-sm task" type="text" id="inputSmall" placeholder="Otra tarea">
                  </td>
                </td>
                <td>
                  <input class="form-control input-sm" type="text" id="inputSmall">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <button type="reset" class="btn btn-primary pull-right" id="remove-task">Eliminar tarea</button>
        <button type="reset" class="btn btn-primary pull-right" id="add-task">Añadir tarea</button>
      </div> -->
    </fieldset>
    <div class="col-md-7">
      <%= link_to(content_tag(:button, 'Cancelar', class: 'btn btn-primary', title: 'Cancelar'), action: 'reset_responses', id: @position.id) %>
    </div>
  </div>
</div>

<script>

    // js for other-tasks inputs

    $("#add-task").click(function() {
      taskTemplate = '<tr class="task-row"><td><td><input class="form-control input-sm" type="text" id="inputSmall" name="name" placeholder="Otra tarea"></td></td><td><input class="form-control input-sm" type="text" id="inputSmall"></td><td><input class="form-control input-sm" type="text" id="inputSmall"></td><td><input class="form-control input-sm" type="text" id="inputSmall"></td><td><input class="form-control input-sm" type="text" id="inputSmall"></td><td><input class="form-control input-sm" type="text" id="inputSmall"></td></tr>'
      if($(".task-row").length < 2) {
        $("#other-tasks").append(taskTemplate);
      }
    })

    $("#remove-task").click(function() {
      if($(".task-row").length >= 1) {
        $(".task-row").last().remove()
      }
    })

    // modal instructions

    var acc = document.getElementsByClassName("accordion");
    var i;

    for (i = 0; i < acc.length; i++) {
      acc[i].onclick = function() {
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        if (panel.style.maxHeight){
          panel.style.maxHeight = null;
        } else {
          panel.style.maxHeight = panel.scrollHeight + "px";
        }
      }
    }
</script>
