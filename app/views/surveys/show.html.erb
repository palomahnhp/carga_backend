<div class="row element-style">
  <div class="col-md-8 col-md-offset-2">
    <div id="errorTagCont" class="'has-error alert alert-danger alert-dismissable'">
      <button name="button" type="button" onclick="$('#errorTagCont').hide();" class="close">×</button>
      <div id="errorTag"></div>
    </div>
    <% if @errors %>
      <% @errors.each do |error| %>
        <div class="'has-error alert alert-danger alert-dismissable'">
          <button name="button" type="button" class="close" data-dismiss="alert">×</button>
          <%= error %>
        </div>
      <% end%>
    <% end%>
    <div class="row">
      <legend class="col-lg-12"><%= @position.unit.campaign.name %></legend>
      </div>
      <button class="accordion">Instrucciones de cumplimentación de la encuesta</button>
      <div class="panel-instructions">
        <table class="table table-striped table-hover ">
          <tbody>
            <tr>
              <td>Instrucción 1. Responder todas las preguntas con un valor numérico.</td>
            </tr>
            <tr>
              <td>Instrucción 2. La suma de las respuestas debe ser igual a 100, ya que se trata de porcentajes.</td>
            </tr>
            <tr>
              <td>Instrucción 3. El valor numérico de las respuestas puede contener hasta 2 decimales.</td>
            </tr>
            <tr>
              <td>Instrucción 4. Se pueden añadir hasta tres funciones extra, proporcionando su descripción.</td>
            </tr>
          </tbody>
        </table>
      </div>
    <form id="survey-form" action="/surveys/create" method="POST">
      <fieldset>  
        <div class="form-group">
          <div class="row question-mark">
            <h4 class="col-lg-12 control-label question">¿En qué ha destinado el tiempo el último trimestre?</h4>
          </div>
          <div class="row">
            <table class="table table-striped table-hover ">
              <thead>
                <th>Función</th>
                <th>% Tiempo</th>
              </thead>
              <tbody>
                <% @pos_functions.each do |function| %>
                  <tr>
                    <td>
                      <div>
                        <p>
                          <%= function.name %>
                        </p>
                      </div>
                    </td>
                    <td>
                      <input class="form-control" style="width: 100px;" type="number" name="time_per_<%= function.id %>" id="survey-input-<%= function.id %>" onchange="showTotal();" min="0" max="100" step="0.01">
                      <input type="hidden" class="form-control input-sm task" type="text" id="inputSmall_<%= function.id %>" value="<%= function.id %>" name="function_id_<%= function.id %>">
                      <input type="hidden" value="<%= form_authenticity_token() %>" name="authenticity_token"/>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
  
        <!-- other tasks form -->
        <div class="form-group">
          <div class="row">
            <label class="col-lg-12 control-label">Otras funciones realizadas: </label>
          </div>
          <div class="row">
            <table class="table table-striped table-hover ">
              <thead>
                <th>Función</th>
                <th>% Tiempo</th>
              </thead>
              <tbody id="other-tasks">
              </tbody>
            </table>
          </div>
          <div class="col-md-12">
            <div class="col-md-6"></div>
            <div class="col-md-3"><div id="add-task-box"><button class="btn btn-primary pull-right" type="button" id="add-task">Añadir función</button></div></div>
            <div class="col-md-3"><div id="remove-task-box"><button class="btn btn-primary pull-right" type="button" id="remove-task">Eliminar función</button></div></div>
          </div>        
        </div>
      </fieldset>
      <hr>
      <div class="col-md-12" style="margin-bottom: 20px;">
        Suma total de las respuestas: <input type="text" id="total" disabled="true" style="width: 70px;" />
      </div>
      <hr>
      <div class="col-md-12">
        <input type="hidden" id="positionId" name="id" value="<%= @position.id %>" />
        <%= link_to(content_tag(:button, 'Cancelar', class: 'btn btn-primary', title: 'Cancelar'), action: 'reset_responses', id: @position.id) %>
        <button class="btn btn-success save-response" type="button" onclick='return formCheck();'>Confirmar</button>
      </div>
    </form>
  </div>
</div>

<script>
    initializeJS();

    // modal instructions

    var acc = document.getElementsByClassName("accordion");
    var i;

    for (i = 0; i < acc.length; i++) {
      acc[i].onclick = function() {
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        if (panel.style.maxHeight){
          panel.style.maxHeight = null;
        } else {
          panel.style.maxHeight = panel.scrollHeight + "px";
        }
      }
    }
</script>
