<% if can? :settings, @current_user %>
  <div class="row element-style">
    <div class="col-md-11 form-style">
      <fieldset>
        <div class="row">
          <legend class="col-lg-12">Configuración de Usuario</legend>
        </div>
        <div class="form-group org-panel">
          <hr>
          <form action="/users/update" method="POST">
            <div class="row edit-row">
              <div class="col-lg-12">

                <div class="col-md-6">
                  <div class="row">
                    <div class="col-md-5">
                      <b>Nombre: </b>
                    </div>
                    <div class="col-md-7">
                      <input type="text" class="form-control" id="inputDefault" name="name" value="<%= @user.name %>">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-5">
                      <b>Primer apellido: </b>
                    </div>
                    <div class="col-md-7">
                      <input type="text" class="form-control" id="inputDefault" name="last_name" value="<%= @user.last_name %>">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-5">
                      <b>Segundo apellido: </b>
                    </div>
                    <div class="col-md-7">
                      <input type="text" class="form-control" id="inputDefault" name="last_name_alt" value="<%= @user.last_name_alt %>">
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="row">
                    <div class="col-md-5">
                      <b>Código Ayre: </b>
                    </div>
                    <div class="col-md-7">
                      <input type="text" class="form-control" id="disabledInput" name="ayre" value="<%= @user.login %>">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-5">
                      <b>Perfil: </b>
                    </div>
                    <div class="col-md-7">
                      <select class="form-control" name="role">
                        <% if @user.superadmin? %>
                          <option name="role" value="2" selected="selected">Superadministrador</option>
                          <option value="1">Administrador</option>
                          <option value="0">Encuestado</option>
                        <% elsif @user.admin? %>
                          <option value="2">Superadministrador</option>
                          <option value="1" selected="selected">Administrador</option>
                          <option value="0">Encuestado</option>
                        <% else %>
                          <option value="2">Superadministrador</option>
                          <option value="1">Administrador</option>
                          <option value="0" selected="selected">Encuestado</option>
                        <% end %>
                       </select>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="row bottom-panel">
                    <div class="col-md-5">
                      <b>Email: </b>
                    </div>
                    <div class="col-md-7">
                      <input type="text" class="form-control" id="inputDefault" name="email" value="<%= @user.email %>">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-5">
                      <b>Teléfono: </b>
                    </div>
                    <div class="col-md-7">
                      <input type="text" class="form-control" id="inputDefault" name="phone_number" value="<%= @user.phone_number %>">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-5">
                      <b>NIF: </b>
                    </div>
                    <div class="col-md-7">
                      <input type="text" class="form-control" id="inputDefault" name="document" value="<%= @user.document %>">
                    </div>
                  </div>
                </div>
                
                <div class="col-md-6">
                    <div class="row">
                      <div class="col-md-5">
                        <b>Área: </b>
                      </div>
                      <div class="col-md-7">
                        <select class="form-control" id="area" name="area" onchange="filterElement('direction');">
                          <option value=""></option>                        
                          <% Unit.select(:area_name).group(:area_name).each do |unit| %>
                            <option value="<%= unit.area_name %>"><%= unit.area_name %></option>
                          <% end %>
                        </select>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-5">
                        <b>Dirección: </b>
                      </div>
                      <div class="col-md-7">
                        <select class="form-control" id="direction" name="direction" onchange="filterElement('subdirection');">
                          <option value=""></option>
                          <% Unit.select(:dir_name).group(:dir_name).each do |unit| %>
                            <option value="<%= unit.dir_name %>"><%= unit.dir_name %></option>
                          <% end %>
                        </select>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-5">
                        <b>Subdirección: </b>
                      </div>
                      <div class="col-md-7">
                        <select class="form-control" id="subdirection" name="subdirection" onchange="filterElement('unit');">
                          <option value=""></option>
                          <% Unit.select(:subdir_name).group(:subdir_name).each do |unit| %>
                            <option value="<%= unit.subdir_name %>"><%= unit.subdir_name %></option>
                          <% end %>
                        </select>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-5">
                        <b>Unidad: </b>
                      </div>
                      <div class="col-md-7">
                        <select class="form-control" id="unit" name="unit" onchange="filterElement('position');">
                          <option value=""></option>
                          <% Unit.select(:name).group(:name).each do |unit| %>
                            <option value="<%= unit.name %>"><%= unit.name %></option>
                          <% end %>
                        </select>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-5">
                        <b>Puesto: </b>
                      </div>
                      <div class="col-md-7">
                        <select class="form-control" id="position" name="position">
                          <option value=""></option>
                          <% Position.select(:name).group(:name).each do |position| %>
                            <option value="<%= position.name %>"><%= position.name %></option>
                          <% end %>
                        </select>
                      </div>
                    </div>
                </div>

              </div>
            </div>
            <hr>
            <div class="row edit-row">
              <div class="col-md-6">
                <input type="hidden"value="<%= @user.id %>" name="id"/>
                <input type="hidden"value="<%= form_authenticity_token() %>" name="authenticity_token"/>
                <button class="btn btn-primary save-changes" type="submit" >Guardar cambios</button>
              </div>
            </div>
          </form>
        </div>
        <div class="col-md-6">
          <a href="/users">
            <button type="submit" class="btn btn-primary">Volver</button>
          </a>
        </div>
      </fieldset>
    </div>
  </div>
<% end %>

<script>
  <% if @user.position %>
    $("#area").val("<%= @user.position.unit.area_name %>");
    $("#direction").val("<%= @user.position.unit.dir_name %>");
    $("#subdirection").val("<%= @user.position.unit.subdir_name %>");
    $("#unit").val("<%= @user.position.unit.name %>");
    $("#position").val("<%= @user.position.name %>");
  <% end %>
</script>