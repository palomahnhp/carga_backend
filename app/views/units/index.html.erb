<% if can? :settings, @current_user %>
<div class="row element-style">
  <div class="col-md-11 form-style">
      <fieldset>
        <div class="row">
          <legend class="col-lg-12">Configuración</legend>
        </div>
        <div class="form-group org-panel">
          <div class="row">
            <label for="select" class="col-lg-12 control-label">Configuración de unidades</label>
            <hr>
          </div>
          <div class="row">
            <div class="col-lg-12">
                <table class="table table-striped table-hover ">
                  <thead>
                    <tr>
                      <th>Número</th>
                      <th>Nombre</th>
                      <th>Campaña</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @units.each do |unit| %>
                      <form action="/units/update" method="POST">
                        <tr>
                          <td>
                            <input type="text" class="form-control" id="inputDefault" name="unit_number" value="<%= unit.unit_number %>">
                          </td>
                          <td>
                            <input type="text" class="form-control" id="inputDefault" name="name" value="<%= unit.name %>">
                          </td>
                          <td>
                            <select class="form-control" id="select" name="campaign_id">
                              <% Campaign.all.each do |campaign| %>
                              <option value="<%= campaign.id %>"
                                <% if campaign.id == unit.campaign_id %>
                                   selected="selected"
                                <% end %>
                                >
                                <%= campaign.name %>
                              </option>
                              <% end %>
                            </select>
                          </td>
                          <td>
                            <input type="hidden"value="<%= unit.id %>" name="id"/>
                            <input type="hidden"value="<%= form_authenticity_token() %>" name="authenticity_token"/>
                            <button class="btn btn-default save-changes" type="submit" >Guardar cambios</button>
                            <button type="button" class="btn btn-default">
                              <%= link_to "Eliminar", {action: 'delete',id: unit.id} %>
                            </button>
                          </td>
                        </tr>
                      </form>
                    <% end %>
                  </tbody>
                </table>
              <div class="col-md-6">
                <a href="/units/new">
                  <button type="button" class="btn btn-success">Añadir unidad</button>
                </a>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
    <div class="col-md-6">
      <a href="/settings">
        <button type="submit" class="btn btn-primary">Volver</button>
      </a>
    </div>
  </div>
</div>
<% end %>

<script>
    (function(){
        if( window.localStorage ){
            if( !localStorage.getItem( 'firstLoad' ) ){
              localStorage[ 'firstLoad' ] = true;
              window.location.reload();
            }
        else
          localStorage.removeItem( 'firstLoad' );
        }
    })();
</script>
